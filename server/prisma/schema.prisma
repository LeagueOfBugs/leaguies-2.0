generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Season {
  id         Int       @id @default(autoincrement())
  name       String    
  startDate  DateTime? 
  endDate    DateTime? 
  isCurrent  Boolean?  @default(false) 
  matches    Match[]   
  leagueId   Int?      
  league     League?   @relation(fields: [leagueId], references: [id])
  trophyId   Int?      @unique
  trophy     Trophy?   @relation("SeasonTrophy", fields: [trophyId], references: [id])
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model Trophy {
  id          Int      @id @default(autoincrement())
  name        String
  description String?  
  season      Season?  @relation("SeasonTrophy") 
  teamId      Int?     
  team        Team?    @relation(fields: [teamId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Award {
  id          Int        @id @default(autoincrement())
  name        String    
  description String?   
  playerId    Int?       
  player      Player?     @relation(fields: [playerId], references: [id], onDelete: SetNull) 
  matchId     Int?      
  match       Match?     @relation("MatchAwards", fields: [matchId], references: [id], onDelete: SetNull) 
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Match {
  id            Int       @id @default(autoincrement())
  name          String
  date          DateTime?  @default(now())
  homeTeamId    Int?      
  awayTeamId    Int?      
  homeTeam      Team?      @relation("HomeMatches", fields: [homeTeamId], references: [id])
  awayTeam      Team?      @relation("AwayMatches", fields: [awayTeamId], references: [id])
  seasonId      Int?      
  season        Season?    @relation(fields: [seasonId], references: [id])
  homeScore     Int?     
  awayScore     Int?     
  referees      MatchReferee[]
  awards        Award[]   @relation("MatchAwards") 
  venueId       Int?       
  venue         Venue?     @relation(fields: [venueId], references: [id]) 
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Referee {
  id         Int            @id @default(autoincrement())
  name       String
  matches    MatchReferee[] 
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
}

model MatchReferee {
  matchId    Int
  refereeId  Int
  match      Match   @relation(fields: [matchId], references: [id], onDelete: Cascade)
  referee    Referee @relation(fields: [refereeId], references: [id], onDelete: Cascade)

  @@id([matchId, refereeId]) // Composite primary key
}

model Venue {
  id         Int      @id @default(autoincrement())
  name       String
  location   String   
  capacity   Int?     
  matches    Match[]  
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Sport {
  id        Int        @id @default(autoincrement())
  name      String  
  positions Position[]  
  statTypes StatType[] 
  leagues   League[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt    
}

model League {
  id        Int      @id @default(autoincrement())
  name      String
  teams     Team[]
  seasons   Season[]
  sportId   Int?      
  sport     Sport?    @relation(fields: [sportId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Team {
  id          Int      @id @default(autoincrement())
  name        String
  players     PlayerTeam[] // Reference to the join table
  leagueId    Int?
  league      League?  @relation(fields: [leagueId], references: [id], onDelete: SetNull) 
  homeMatches Match[]  @relation("HomeMatches")
  awayMatches Match[]  @relation("AwayMatches")
  trophies    Trophy[] 
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Position {
  id           Int          @id @default(autoincrement())
  name         String
  abbreviation String?     
  sportId      Int         
  sport        Sport        @relation(fields: [sportId], references: [id])
  subPositions SubPosition[] 
  players      Player[] 
}

model SubPosition {
  id           Int      @id @default(autoincrement())
  name         String
  abbreviation String? 
  positionId   Int      
  position     Position  @relation(fields: [positionId], references: [id])
}

model Player {
  id         Int           @id @default(autoincrement())
  name       String
  awards     Award[]
  positionId Int?    
  position   Position?     @relation(fields: [positionId], references: [id]) 
  stats      PlayerStats[] 
  teams      PlayerTeam[]  // Reference to the join table
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
}

model PlayerTeam {
  playerId Int
  teamId   Int
  player   Player @relation(fields: [playerId], references: [id], onDelete: Cascade)
  team     Team   @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@id([playerId, teamId]) // Composite primary key
}

model PlayerStats {
  id           Int      @id @default(autoincrement())
  playerId     Int      
  player       Player   @relation(fields: [playerId], references: [id]) 
  statTypeId   Int      
  statType     StatType @relation(fields: [statTypeId], references: [id]) 
  value        Float?     
}

model StatType {
  id           Int      @id @default(autoincrement())
  name         String   
  abbreviation String?  
  description  String?   
  sportId      Int      
  sport        Sport    @relation(fields: [sportId], references: [id])
  playerStats  PlayerStats[] 
}

